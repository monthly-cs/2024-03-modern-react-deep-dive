# DIL: ëª¨ë˜ ë¦¬ì•¡íŠ¸ ë”¥ ë‹¤ì´ë¸Œ, 2ì£¼ì°¨-2

> ìŠ¤í„°ë””: ì›”ê°„ CS, https://github.com/monthly-cs/2024-03-modern-react-deep-dive  
> ì˜¤ëŠ˜ ì§„í–‰: ê°œì¸ê³µë¶€

---

## DIL-week2-2_2024-03-12

| DIL ì£¼ì°¨ | ë²”ìœ„   | ë‚´ìš©                           | ì˜¤ëŠ˜ì°¨ ì§„ë„ |
| -------- | ------ | ------------------------------ | ----------- |
| 2ì£¼ì°¨    | 3, 5ì¥ | ë¦¬ì•¡íŠ¸ í•µì‹¬ìš”ì†Œì™€ ìë°”ìŠ¤í¬ë¦½íŠ¸ | 194p~207p   |

> `ì˜¤ëŠ˜ ì½ì€ ë‚´ìš©ì„ markdownìœ¼ë¡œ ê°„ë‹¨íˆ ë©”ëª¨`  
> ì½ì€ ì‹œê°„: 11ì‹œ~12ì‹œ  
> ê°ê¸° ì´ìŠˆğŸ¤•

---

## React Hook íŒŒí—¤ì¹˜ê¸°

### useState

#### ê²Œìœ¼ë¥¸ ì´ˆê¸°í™”ë€? lazy initialization

- useStateì˜ ì´ˆê¹ƒê°’ì´ ë³µì¡í•˜ê±°ë‚˜ ë¬´ê±°ìš´ ì—°ì‚°ì„ í¬í•¨í•˜ê³  ìˆì„ ë•Œ ì‚¬ìš©
  - ê²Œìœ¼ë¥¸ ì´ˆê¸°í™” í•¨ìˆ˜ëŠ” stateê°€ ì²˜ìŒ ë§Œë“¤ì–´ì§ˆ ë•Œë§Œ ì‚¬ìš©ëœë‹¤(ì´í›„ í•¨ìˆ˜ì˜ ì‹¤í–‰ì€ ë¬´ì‹œëœë‹¤)
- ì¶”ì²œ ì¼€ì´ìŠ¤ (ì‹¤í–‰ ë¹„ìš©ì´ ë§ì´ ë“œëŠ” ê²½ìš°)
  - localStorage, sessionStorage ì ‘ê·¼
  - ë°°ì—´ ì ‘ê·¼: map, filter, find
  - ì´ˆê¸°ê°’ ê²Œì‚°ì— í•¨ìˆ˜ í˜¸ì¶œì´ í•„ìš”í•  ë•Œ

### useEffect

- ì• í”Œë¦¬ì¼€ì´ì…˜ ë‚´ ì»´í¬ë„ŒíŠ¸ì˜ ê°’ë“¤ì„ í™œìš©í•˜ì—¬ ë™ê¸°ì ìœ¼ë¡œ ë¶€ìˆ˜ íš¨ê³¼ë¥¼ ë§Œë“ ë‹¤. side-effects
- ì–´ë–»ê²Œ ì˜ì¡´ì„± ë°°ì—´ì´ ë³€ê²½ëœ ê²ƒì„ ì•Œ ìˆ˜ ìˆë‚˜?
  - í•¨ìˆ˜ ì»´í¬ë„ŒíŠ¸ëŠ” => ë§¤ë²ˆ í•¨ìˆ˜ë¥¼ ì‹¤í–‰í•´ ëœë”ë§ì„ ìˆ˜í–‰í•œë‹¤
  - ëœë”ë§ ì‹œë§ˆë‹¤ ê³ ìœ ì˜ state, props ê°’ì„ ê°–ê³  ìˆìŒ
- useEffectëŠ”? í‰ë²”í•œ í•¨ìˆ˜ë‹¤
  - íŠ¹ë³„í•œ ê¸°ëŠ¥ì„ ê°€ì§„ ê²ƒì´ ì•„ë‹˜ like proxy, ë°ì´í„° ë°”ì¸ë”©, ì˜µì €ë²„
  - stateê³¼ props ë³€í™” > ëœë”ë§ > ë¶€ìˆ˜ íš¨ê³¼

### í´ë¦°ì—… í•¨ìˆ˜ clean-up function

- í´ë¦°ì—… í•¨ìˆ˜ëŠ”? => ì´ì „ stateì„ ì°¸ì¡°í•´ ì‹¤í–‰ëœë‹¤
  - (ì‹œê¸°) í´ë¦°ì—… í•¨ìˆ˜ëŠ” ìƒˆë¡œìš´ ê°’ê³¼ í•¨ê»˜ ëœë”ë§ëœ ë’¤ì— ì‹¤í–‰ëœë‹¤
  - (ê°’) í´ë¦°ì—… í•¨ìˆ˜ëŠ” ìƒˆë¡œìš´ ê°’ì„ ì½ëŠ” ê²ƒì´ ì•„ë‹ˆë¼, í•¨ìˆ˜ê°€ ì •ì˜ëì„ ë‹¹ì‹œì— ì„ ì–¸ëë˜ ì´ì „ ê°’ì„ ë³´ê³  ì‹¤í–‰ëœë‹¤
- useEffectëŠ” ì½œë°±ì´ ì‹¤í–‰ë  ë•Œ => í´ë¦°ì—… í•¨ìˆ˜ê°€ ì¡´ì¬í•œë‹¤ë©´ í´ë¦°ì—… í•¨ìˆ˜ë¥¼ ì‹¤í–‰í•œ í›„ ì½œë°±ì„ ì‹¤í–‰
  - unmountê°€ ì•„ë‹˜!
  - í•¨ìˆ˜ ì»´í¬ë„ŒíŠ¸ê°€ ë¦¬ëœë”ë§ ëì„ ë•Œ, ì˜ì¡´ì„± ë³€í™”ê°€ ìˆì—ˆì„ ë‹¹ì‹œ ì´ì „ì˜ ê°’ì„ ê¸°ì¤€ìœ¼ë¡œ ì‹¤í–‰ë˜ëŠ” => ì²­ì†Œ ê°œë…~!

### ì˜ì¡´ì„± ë°°ì—´

- useEffectëŠ” ì˜ì¡´ì„± ë°°ì—´ì˜ ì´ì „ ê°’ê³¼ í˜„ì¬ ê°’ì„ ì–•ì€ ë¹„êµí•œë‹¤.(Object.is)
- í•˜ë‚˜ë¼ë„ ë³€ê²½ ì‚¬í•­ì´ ìˆë‹¤ë©´, callbackìœ¼ë¡œ ì„ ì–¸í•œ ë¶€ìˆ˜ íš¨ê³¼ë¥¼ ì‹¤í–‰í•œë‹¤.

#### ì˜ì¡´ì„± ë°°ì—´ ìì²´ê°€ ì—†ëŠ” ê²½ìš°

- ì»´í¬ë„ŒíŠ¸ê°€ ëœë”ë§ ëëŠ”ì§€ í™•ì¸ìš©
- ê·¸ëƒ¥ useEffect ì—†ì´ ì“°ë©´ ë˜ëŠ” ê±° ì•„ë‹˜?

1. ì„œë²„ ì‚¬ì´ë“œ ëœë”ë§ ê´€ì 

   - í´ë¼ì´ì–¸íŠ¸ ì‚¬ì´ë“œì—ì„œ ì‹¤í–‰ë˜ëŠ” ê²ƒì„ ë³´ì¥í•œë‹¤
   - ì¦‰, window ê°ì²´ì— ì ‘ê·¼ì— ì˜ì¡´í•˜ëŠ” ì½”ë“œ ok

2. useEffectëŠ” ì»´í¬ë„ŒíŠ¸ ëœë”ë§(side effect)ì´ ì™„ë£Œëœ ì´í›„ì— ì‹¤í–‰ëœë‹¤

   - ì½”ë“œë¥¼ ì§ì ‘ ì‹¤í–‰í•  ì‹œ, ëœë”ë§ ë„ì¤‘ì— ì‹¤í–‰ëœë‹¤
   - (ì„œë²„ ì‚¬ì´ë“œ ëœë”ë§ì˜ ê²½ìš°, ì„œë²„ì—ì„œ ì‹¤í–‰)
   - í•¨ìˆ˜ ì»´í¬ë„ŒíŠ¸ì˜ ë°˜í™˜ì„ ì§€ì—°ì‹œí‚¨ë‹¤. ë¬´ê±°ìš´ ì‘ì—…ì¼ ê²½ìš° ëœë”ë§ì„ ë°©í•´, ì„±ëŠ¥ ì €í•˜

#### ì£¼ì˜í•  ì : ì˜ì¡´ì„± ë°°ì—´ì— ë¹ˆ ë°°ì—´ì„ ê³ ì§‘í•˜ë©´ ì•ˆë˜ëŠ” ì´ìœ 

- `eslint-disable-line react-hook/exhaustive-deps`

1. ì ‘ê·¼ë²•ì˜ ë¬¸ì œ
   - ì»´í¬ë„ŒíŠ¸ë¥¼ ë§ˆìš´íŠ¸ í•˜ëŠ” ì‹œì ì—ë§Œ ì‹¤í–‰í•˜ê³  ì‹¶ë‹¤?
   - componentDidMountì— ê¸°ë°˜í•œ ì ‘ê·¼ë²•ìœ¼ë¡œ, ì‚¬ìš©í•´ì„  ì•ˆë¨
2. side effect
   - ì»´í¬ë„ŒíŠ¸ì˜ state, propsì˜ ê°’ ë³€ê²½ê³¼, ë¶€ìˆ˜ íš¨ê³¼ ì‚¬ì´ì˜ ì—°ê²° ê³ ë¦¬ê°€ ëŠì–´ì§
     - ë¶€ìˆ˜ íš¨ê³¼ê°€ ì‹¤ì œë¡œ ê´€ì°°ë˜ì„œ ì‹¤í–‰ë˜ì•¼ í•˜ëŠ” ê°’ê³¼ ë³„ê°œë¡œ ì‘ë™ë¨
   - ë¶€ìˆ˜ íš¨ê³¼ê°€ ë¶€ìˆ˜ íš¨ê³¼ê°€ ì•„ë‹ˆê²Œ ë˜ëŠ” ê²ƒ
3. ë¡œì§ì˜ ë¬¸ì œ ì²´í¬
   - ì •ë§ ë¶€ìˆ˜ íš¨ê³¼ê°€ ì»´í¬ë„ŒíŠ¸ì˜ ìƒíƒœì™€ "ë³„ê°œ"ë¡œ ì‘ë™í•´ì•¼ë§Œ í•˜ëŠ” ì§€ í™•ì¸
   - ë¶€ìˆ˜ íš¨ê³¼ì˜ ì‹¤í–‰ ìœ„ì¹˜ê°€ ì ì ˆí•œ ì§€ í™•ì¸
     - í•„ìš”í•˜ë‹¤ë©´, ë¶€ëª¨ ì»´í¬ë„ŒíŠ¸ì—ì„œ ë³€ê²½ëœ ê°’ì„ propsë¡œ ì „ë‹¬ë°›ê¸°
     - `ë¶€ìˆ˜ íš¨ê³¼ì˜ íë¦„`ì„ ê±°ìŠ¤ë¥´ì§€ ì•Šì„ ìˆ˜ ìˆë‹¤.

#### useEffect ì²« ë²ˆì§¸ ì¸ìˆ˜(ì½œë°± í•¨ìˆ˜)ì— í•¨ìˆ˜ëª… ë¶€ì—¬í•˜ê¸°

- í•´ë‹¹ useEffectì˜ ëª©ì ì„ íŒŒì•…í•˜ê¸° ìœ„í•´ ìœ ìš©í•˜ê²Œ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.
  - ì±…ì„ì„ ìµœì†Œí•œìœ¼ë¡œ ì¢íŒë‹¤

```tsx
useEffect(
  function logActiveUse() {
    logging(user.id);
  },
  [user.id]
);
```

#### ê±°ëŒ€í•œ useEffect X

- ë¶€ìˆ˜ íš¨ê³¼ê°€ í¬ë‹¤ë©´?
  - ëœë”ë§ì—ëŠ” ì˜í–¥ì„ ì ê²Œ ë¯¸ì¹œë‹¤ (ëœë”ë§ ì´í›„ì— ì‹¤í–‰ë˜ë‹ˆê¹Œ)
  - ìë°”ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰ ì„±ëŠ¥ì— ì˜í–¥ì„ ë¯¸ì¹œë‹¤ (ëœë”ë§ ì‹œ ì˜ì¡´ì„± ë°°ì—´ì´ ë³€ê²½ë˜ì—ˆì„ ë•Œë§ˆë‹¤ ì‹¤í–‰ë˜ë‹ˆê¹Œ)
- ê´€ë¦¬í•˜ê¸° ì–´ë ¤ìš´ ìˆ˜ì¤€ê¹Œì§€ ì»¤ì§„ë‹¤ë©´?
  - ì–¸ì œ ë°œìƒí•˜ëŠ” ì§€ ì•Œ ìˆ˜ ì—†ìŒ
  - ìµœëŒ€í•œ useCallbackê³¼ useMemoë¡œ ì •ì œí•œ ë‚´ìš©ë§Œ useEffectì— ë‹´ëŠ”ë‹¤.

#### ë¶ˆí•„ìš”í•œ ì™¸ë¶€ í•¨ìˆ˜ x

- useEffect ë°–ì—ì„œ í•¨ìˆ˜ë¥¼ ì„ ì–¸í•˜ë©´?
  - ë¶ˆí•„ìš”í•œ ì½”ë“œê°€ ë§ì•„ì§€ê³ , ê°€ë…ì„±ì´ ë–¨ì–´ì§
- useEffect ë‚´ì—ì„œ ì‚¬ìš©í•  side effectë¼ë©´? => ë‚´ë¶€ì—ì„œ ë§Œë“¤ì–´ì„œ ì •ì˜í•´ì„œ ì‚¬ìš©

#### ì™œ useEffectì˜ ì½œë°± ì¸ìˆ˜ëŠ” ë¹„ë™ê¸°ê°€ ë  ìˆ˜ ì—†ëŠ”ê°€?

> "ê°œë°œìì˜ í¸ì˜"

1. `race condition of useEffect`
   - ë¹„ë™ê¸° í•¨ìˆ˜ì˜ ì‘ë‹µ ì†ë„ì— ë”°ë¼ ê²°ê³¼ê°€ ì´ìƒí•  ìˆ˜ ìˆë‹¤
     - ìƒíƒœë³€í™”A: ë¹„ë™ê¸° ì²˜ë¦¬ì— 10ì´ˆ
     - ì´í›„ ìƒíƒœë³€í™”B: ë¹„ë™ê¸° ì²˜ë¦¬ì— 1ì´ˆ
     - race conditionì´ ë°œìƒí•´ stateì´ => B => Aê°€ ë  ìˆ˜ ìˆë‹¤
2. cleanup í•¨ìˆ˜ì˜ ì‹¤í–‰ ìˆœì„œë¥¼ ë³´ì¥í•  ìˆ˜ ì—†ë‹¤.

---

### ì˜ˆì œ - 207p

```tsx
function Component({ id }: { id: string }) {
  const [info, setInfo] = useState<number | null>(null);

  useEffect(() => {
    const controller = new AbortController();

    (async () => {
      const result = await fetchInfo(id, { signal: controller.signal });
      setInfo(await result.json());
    })();

    return () => controller.abort();
  }, [id]);

  return <></>;
}
```
