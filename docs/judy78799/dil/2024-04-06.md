# 모던 리액트 딥다이브 week5
# 2024-04-05 DIL

|주차|DIL 범위|날짜|개인 진도|
|------|---|---|---|
| 5주차 |9장|2024-04-05|604-654p|


# 리액트 애플리케이션 배포하기

#### 가장 쉽고 빠르면서도 안정적인 방법으로 배포할 수 있는 몇가지 SaaS 서비스를 알아보자. (개인 프로젝트 X.)
- Netlify, Vercel, DigitalOcean 등이 있다.
- 서비스 별로 제공하는 기능은 일부를 제외하면 비슷하다.
- 대부분 3~4 단계 내로 웹 서비스 배포와 관련된 사전지식이 많지 않더라도 배포를 쉽고 빠르게 할 수 있다.
- 현재 개발 중인 웹 개수 등을 고려 후 판단하여 사용하기 (서비스 이동은 생각보다 쉽지 않음.)

## Netlify

- 웹 애플리케이션을 배포할 수 있도록 도와주는 클라우드 컴퓨팅 서비스.
- 역사가 오래됨 / 어느정도 무료

### Netlify create-react-app으로 생성한 앱 배포하기

- 가입 후 팀(서비스의 기본 단위)을 생성 - Start for Free
- import an existing project를 눌러 저장소를 불러온다.
- 저장소: 레포지토리 이름 작성.
- 빌드 및 배포 관련 설정을 추가.
- > Branch to deploy: Merge가 일어났을 때 자동으로 배포가 수행되는 타깃 브랜치를 명시.
  > Base directory: 배포 명령어를 실행할 기본 디렉터리.
  > Build Command: 빌드 명령어.
  > Publish directory: 실제 서빗에 필요한 정적인 리소스가 위치한 디렉터리.
  
※Add environment variables 버튼을 눌러 프로젝트에 필요한 환경변수 지정가능.


### create-next-app으로 생성한 앱 배포하기 - 약간의 설정이 필요.

서버 사이드 애플리케이션을 서비스하므로 추가적인 설정이 필요.
- Next.js 애플리케이션 루트에 netlyfy.toml 파일을 생성한다.
- @netlify/plugin-nextjs 플러그앤은 Next.js 기반 애플리케이션을 배포하는데 도움을 준다.
- 동일한 배포설정을 위해 publish directory에 /.next로 지정해준다.

```jsx
[[plugins]]
package = "@netlify/plugin-nextjs"
```

### 사용시 주의사항

- 대역폭 월 100GB
- 빌드시간 최대 300분
- 동시 빌드 X 순차적으로 빌드해야 함.


## Vercel
Netlify와 비슷한 클라우드 서비스


### create-next-app으로 생성한 앱 배포하기
Netlify와는 다르게 Next.js 서비스를 별도의 설정 없이 배포할 수 있다.


### 추가기능

- 알림
- 도메인 연결: 별도로 구매한 도메인을 연결.
- Serverless Function
- 다양한 템플릿



## DigitalOcean

- 저장소를 바탕으로 바로 배포할 수 있는 서비스를 제공.
- 다른 업체와 다르게 Github Student Pack에 포함.
- 다양한 리소스에 대해 문서화가 상세하게 되어있음.
- 자체 블로그 운영.


### 추가기능

- 알림
- 컨테이너에 직접 접근
- 마켓플레이스
- 도메인 연결


## 리액트 애플리케이션 도커라이즈 하기

- 본격적으로 사용자에게 서비스하기 위한 웹 애플리케이션을 서비스하기에는 적절하지 않다.
- 자유롭게 커스터마이징하는 데 제약이 있다.
- 과거와 다르게 애플리케이션을 한의 컨테이너로 만들어 빠르게 배초한다.
  
### 도커란?

- 개발자가 모던 애플리케이션을 구축, 공유, 실행하는 것을 도와줄 수 있도록 설계된 플랫폼이다.
- 애플리케이션을 컨테이너 단위로 패키징한다.
- 컨테이너를 바탕으로 독립된 환경에서 애플리케이션이 항상 일관되게 실행할 수 있도록 보장해줌.

### 도커용어

Dockerfile에 필요한 것을 모아 빌드하면 "이미지". <br>
해당 이미지를 실행시키면 "컨테이너(가상화 환경)". <br>
이미지를 식별할 수 있는 레이블 값이 "태그", <br>
이미지를 모아두는 장소가 "리포지터리", <br>
다양한 리포지토리에 접근할 수 있도록 하는 서비스가 "레지스트리" 이다. <br>


### create-react-app을 도커 이미지로 만들어보기

1. 도커 설치
2. Dockerfile 작성하기
3. 작성한 도커 이미지를 빌드
4. 애플리케이션 실행을 위해 Dockerfile에 내용 추가

### create-next-app을 도커 이미지로 만들어보기

1. 프로젝트의 루트에 Dockerfile 생성
2. 프로젝트 빌드에 필요한 package.json, package-lock.json을 설치하여 node_modules를 생성
3. build 단게에서 deps에서 생성한 node_modules를 복사하여 사용. /프로젝트 빌드.
4. 빌드한 이미지를 실행할 준비: next.config.js에 내용추가
   > output: Next.js에서 빌드를 위해 제공하는 기능.
5. 마지막으로 runner 단계를 만들어서 standalone으로 만들어진 Next.js를 실행.
6. 사용해야 할 포트를 EXPOSE로 설정, ENTRYPOINT로 node server.js를 실행. 


### 도커로 만든 이미지 배포하기

- '도커 허브'라는 공간에 업로드 가능.
- 도커 데스크 톱을 이용한다면 쉽게 업로드가 가능하다.

  1. 저장소 생성
  2. 저장소에 이미지 푸쉬(이미지 태그명이 사용자명/저장소명: 태그명) 형식으로 일치해야 함.
  3. Push to Hub을 눌러 도커 허브로 배포.


### 도커 이미지 실행하기

- GCP(Google Cloud Platform) 가입.
- 사용자의 기기에서 GCP를 제어할 수 있는 gcloud cli를 설치.
- gcloud 명령어를 사용하기 위해 명령어로 로그인: gcloud auth login
- 앞서 만든 프로젝트를 기본 프로젝트로 지정.
- 빌드된 도커 이미지를 준비.
- 구글 클라우드 플랫폼의 콘솔에 접속.
- Artifact Registry를 찾아 서비스에 접속
- 페이지 상단의 저장소 만들기를 눌러 저장소를 만든다.
- 만들어진 빈 저장소의 주소 확인.(푸쉬할 이미지의 이름)
- 이미지를 푸쉬하기 위해 앞의 주소가 GCP를 향하는 것으로 도커에 설정해야 함.
- Cloud Run에서 이미지를 실행한다.
  > 지속적으로 새 버전을 '소스 저장소에서 지속적으로 새 버전 배포'를 선택한다.
