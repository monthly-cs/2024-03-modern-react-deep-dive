# 모던 리액트 딥다이브 week4
# 2024-03-25 DIL

|주차|DIL 범위|날짜|개인 진도|
|------|---|---|---|
| 4주차 |4장, 8장|2024-03-25|483-499p|

...이어서
# 완전히 새로운 규칙 만들기: new Date()를 금지시키는 규칙

### 해당 상황이 있다고 가정해보자.

- newDate()사용 못함.
- ServerDate()를 만들어 서버의 시간을 반환하는 함수만 사용해야 함.
- 이러한 규칙을 준수하기 위해 ESLint 규칙을 만들어야 한다.

이 규칙을 만들기 위해 먼저 자바스크립트의 내부에서 new Date()의 존재를 파악해야 한다.

### AST로 코드를 분석해보면,

- ExpressionStatement는 표현식 전체를 나타낸다.(ExpressionStatement.expression/callee/arguments..)
- .expression: 어떤 표현이 들어가 있는지 확인한다. ESLint에서 확인하는 하나의 노드단위.
- .expression.type: 해당 표현이 어떤 타입인지 나타낸다.(생성자를 사용 - NewExpression)
- .expression.callee: 생성자의 이름. /생성자를 사용한 표현식에서 사용됨.
- .expression.arguments: 생성자에게 전달하는 인수를 나타낸다. /생성자를 사용한 표현식에서 사용됨.

### 금지해야할 노드가 명확해진다.

- type: NewExpression
- callee.name: Date,
- ExpressionStatement.expression.arguments가 빈 배열인 경우. //이를 가지고 create 함수를 통해 규칙을 만들어보자.

create함수는 객체를 반환해야 하는데. 
반환하는 객체에서 코드스멜을 감지할 선택자나 이벤트 명 등을 선언할 수 있다.

1. NewExpression이라고 하는 타입의 선택자를 키로 선언하여 new생성자를 사용할 때 ESLint가 실행되도록 한다.
2. if~ 해당 node를 기준으로 찾고자 하는 생성자인지 검증하는 코드를 넣는다.
3. context.export를 통해 해당 코드 스멜을 리포트한다.
4. 문제가 되는 node와 찾았을 때 노출하고 싶은 message를 가리킨다.
5. 메시지 정보는 meta.message의 객체에 키 값을 선언해두면 해당 키 값을 가진 meta.messages의 값을 가져오게 된다.
6. fix 키로 하는 함수를 활용해 자동으로 수정하는 코드를 넣어줄 수 있다.

※ 반드시 eslint-plugin 형태로 규칙을 묶음으로 배포하는 것만 가능하다.

### 배포하는 방법

- 빈 패키지를 만든다.
- yo와 generate-eslint를 활용해 eslint-plugin을 구성할 환경을 만든다.
- 디렉터리와 파일이 생성된다.
- rules/no-new-date.js 파일을 열고 앞에서 작성한 ESLint 규칙을 붙여넣자.
- docs에는 해당 규칙을 위한 설명/ tests에는 테스트 코드를 작성한다.
- npm publish로 배포한다.
- 원하는 프로젝트에서 설치하여 사용한다.

### ESLint를 사용할 때 주의할 점

#### Prettier와의 충돌

Prettier는 ESLint와 마찬가지로 코드를 정적 분석해서 문제를 해결한다.
ESLint는 코드의 잠재적인 문제가 될 수 있는 부분을 분석./ 자바스크립트에서만 사용가능.
Prettier는 포매팅과 관련된 작업(줄바꿈, 들여쓰기, 작은/큰 따옴표)을 담당한다./ 다양한 언어에서 적용이 가능하다.

#### 문제: ESLint에서도 Prettier에서 처리하는 작업을 처리할 수 있기 때문에 서로 충돌하는 규칙으로 인해 에러가 발생한다.



